<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pomodoro Clock</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <style>
      body {
        background-color: #0b2545;
        color: #eef4ed;
        font-family: 'Poppins', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      .timer-box {
        background-color: #13315c;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0px 0px 15px rgba(0,0,0,0.4);
        text-align: center;
      }
      .time-display {
        font-size: 4rem;
        font-weight: bold;
      }
      button {
        margin: 0.25rem;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
<script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      function App() {
        const [breakLength, setBreakLength] = useState(5);
        const [sessionLength, setSessionLength] = useState(25);
        const [timeLeft, setTimeLeft] = useState(25 * 60);
        const [isRunning, setIsRunning] = useState(false);
        const [isSession, setIsSession] = useState(true);
        const timerRef = useRef(null);
        const beepRef = useRef(null);

        const formatTime = (seconds) => {
          const m = Math.floor(seconds / 60);
          const s = seconds % 60;
          return `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
        };

        const handleReset = () => {
          clearInterval(timerRef.current);
          setBreakLength(5);
          setSessionLength(25);
          setTimeLeft(25 * 60);
          setIsRunning(false);
          setIsSession(true);
          beepRef.current.pause();
          beepRef.current.currentTime = 0;
        };

        const handleStartStop = () => {
          if (isRunning) {
            clearInterval(timerRef.current);
            setIsRunning(false);
          } else {
            setIsRunning(true);
          }
        };

        useEffect(() => {
          if (isRunning) {
            timerRef.current = setInterval(() => {
              setTimeLeft((prev) => {
                if (prev === 0) {
                  beepRef.current.play();
                  if (isSession) {
                    setIsSession(false);
                    return breakLength * 60;
                  } else {
                    setIsSession(true);
                    return sessionLength * 60;
                  }
                }
                return prev - 1;
              });
            }, 1000);
          }
          return () => clearInterval(timerRef.current);
        }, [isRunning, isSession, breakLength, sessionLength]);

        const changeLength = (type, amount) => {
          if (isRunning) return;
          if (type === 'break') {
            setBreakLength((prev) => {
              let newVal = prev + amount;
              if (newVal <= 0 || newVal > 60) return prev;
              return newVal;
            });
          }
          if (type === 'session') {
            setSessionLength((prev) => {
              let newVal = prev + amount;
              if (newVal <= 0 || newVal > 60) return prev;
              setTimeLeft(newVal * 60);
              return newVal;
            });
          }
        };

        return (
          <div className="timer-box">
            <h1>Pomodoro Clock</h1>
            <div className="d-flex justify-content-around mb-4">
              <div>
                <h4 id="break-label">Break Length</h4>
                <button
                  id="break-decrement"
                  className="btn btn-light"
                  onClick={() => changeLength('break', -1)}
                >
                  -
                </button>
                <span id="break-length" className="mx-2">{breakLength}</span>
                <button
                  id="break-increment"
                  className="btn btn-light"
                  onClick={() => changeLength('break', 1)}
                >
                  +
                </button>
              </div>
              <div>
                <h4 id="session-label">Session Length</h4>
                <button
                  id="session-decrement"
                  className="btn btn-light"
                  onClick={() => changeLength('session', -1)}
                >
                  -
                </button>
                <span id="session-length" className="mx-2">{sessionLength}</span>
                <button
                  id="session-increment"
                  className="btn btn-light"
                  onClick={() => changeLength('session', 1)}
                >
                  +
                </button>
              </div>
            </div>
            <div>
              <h3 id="timer-label">{isSession ? 'Session' : 'Break'}</h3>
              <div id="time-left" className="time-display">
                {formatTime(timeLeft)}
              </div>
            </div>
            <div className="mt-3">
              <button
                id="start_stop"
                className="btn btn-success"
                onClick={handleStartStop}
              >
                {isRunning ? 'Pause' : 'Start'}
              </button>
              <button
                id="reset"
                className="btn btn-danger ms-2"
                onClick={handleReset}
              >
                Reset
              </button>
            </div>
            <audio
              id="beep"
              ref={beepRef}
              src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"
              preload="auto"
            />
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
